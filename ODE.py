import numpy as np
from scipy.integrate import odeint
import matplotlib.pyplot as plt
import functions as func

M = 1
B = 10
k = 20
u = 1
t = np.linspace(0, 10, 500)

y0 = [0, 0]
mengaX = [0.0, 0.04803314124262707, 0.1799567872139412, 0.37957708734233236, 0.6331485576325565, 0.9290294325561672,
          1.1986391392662783, 1.3218778653196317, 1.3201594152830833, 1.2161881765693927, 1.0292892227739587,
          0.8493711307695423, 0.7874978560181448, 0.8240952410295624, 0.941015082077651, 1.0827214918514978,
          1.1091122170061691, 1.029680667610504, 0.9234920635220838, 0.9186965318884819, 1.0010425919266708,
          1.0564311155830683, 1.0011147791467225, 0.9496842448434178, 0.9936367525107198, 1.0322283698011538,
          0.977222512706093, 0.9828445646343731, 1.0218708874305025, 0.9802111340613476, 1.004927556544068,
          0.9992859198666193, 0.9928302993996799, 1.0038379373137674, 0.9956331233811136, 0.996930626700748,
          1.0053830037439204, 0.9922270691951626, 1.0013160505529066, 1.004709600050783, 0.998211226402027,
          0.9956051398452324, 0.9961364156035654, 0.9969604195289877, 0.9972046599240615, 0.9972941995763581,
          0.9984414859988463, 1.0013339069789993, 1.0004763129842225, 0.9985122250476595, 1.0011794238958887,
          0.9988671584357507, 1.0001651189127694, 1.0007008966662432, 0.999560749623802, 0.9992220097843493,
          0.9993354900146197, 0.99945452958971, 0.9994813224977305, 0.9994875055891473, 0.9996025599410399,
          0.9999094969432142, 1.0002328693238078, 1.0002040010031898, 0.9998462872482086, 0.9997224411564845,
          1.0000200209043821, 1.0001484696510392, 0.9998741399787079, 0.9998312030658779, 1.0000764325020748,
          1.0000138236960594, 0.9998412189884163, 0.9999832972980616, 1.0000462241488501, 0.9998914627649552,
          0.9999377550367734, 1.00003491925275, 0.9999316842431096, 0.9999234646329995, 1.000013931132157,
          0.999956453435218, 0.9999239354388336, 0.9999946677390225, 0.9999695933131213, 0.999930256337567,
          0.9999799440936079, 0.999975243661996, 0.999938118716302, 0.9999697732976408, 0.9999764442622527,
          0.9999455380621318, 0.9999633595010905, 0.9999752363997997, 0.9999516984947804, 0.999959764535438,
          0.9999729378466451, 0.9999563819909527, 0.9999581333779284, 0.9999703566396122, 0.9999596751081031,
          0.9999577656089075, 0.9999679513948546, 0.9999618012037395, 0.9999581294202524, 0.9999659420534307,
          0.9999630280671616, 0.999958846751168, 0.9999643982494317, 0.9999636120637513, 0.999959668197392,
          0.9999633001932987, 0.9999637729529033, 0.999960445565195, 0.99996258087003, 0.9999636830717689,
          0.9999611023325881, 0.9999621574601841, 0.9999634669241014, 0.999961612434997, 0.9999619481359727,
          0.9999632084493725, 0.9999619792278469, 0.9999618818971767, 0.9999629596087065, 0.9999622218819891,
          0.9999619013970152, 0.9999627457957599, 0.9999623674664718, 0.999961965719207, 0.9999625785805022,
          0.999962441478195, 0.9999620464527964, 0.9999624573406907, 0.9999624672923659, 0.9999621256429118,
          0.9999623766811189, 0.9999624636109549, 0.9999621938481502, 0.9999623280187966, 0.999962444861964,
          0.9999622479581742, 0.9999623027882535, 0.9999624201869265, 0.9999622868162346, 0.9999622931271568,
          0.9999623959094354, 0.9999623126547782, 0.9999622934488241, 0.9999623751807585, 0.9999623281163339,
          0.9999622982289966, 0.9999623589913841, 0.9999623363163599, 0.9999623053172644, 0.9999623471484628,
          0.9999623394323647, 0.9999623124437871, 0.9999623394499729, 0.9999623395354856, 0.9999623181863991,
          0.9999623351413846, 0.9999623382826102, 0.9999623223291274, 0.9999623326580744, 0.999962336844518,
          0.9999623255796172, 0.9999623315071176, 0.99996233512185, 0.9999623279472114, 0.9999623312071462,
          0.9999623339056232, 0.9999623284546292, 0.9999623314089592, 0.999962333502807, 0.9999623285468537,
          0.9999623317803135, 0.9999623332628677, 0.9999623285127708, 0.999962332213333, 0.9999623330493693,
          0.9999623283542637, 0.9999623322059681, 0.9999623324535589, 0.9999623289462537, 0.9999623326424449,
          0.9999623319836866, 0.9999623288546103, 0.9999623335289946, 0.9999623309808889, 0.9999623290372287,
          0.9999623338569446, 0.9999623305357841, 0.9999623291403293, 0.999962333909976, 0.9999623306447087,
          0.9999623298331954, 0.9999623333660529, 0.9999623302629959, 0.9999623301246315, 0.9999623337629806,
          0.9999623293778087, 0.9999623307716965, 0.9999623332889439, 0.9999623296337186, 0.9999623311684409,
          0.9999623330458003, 0.9999623289760676, 0.999962332187317, 0.9999623325344077, 0.9999623287080294,
          0.9999623325389952, 0.999962332181843, 0.9999623287949375, 0.9999623331293788, 0.9999623315025249,
          0.9999623288726514, 0.9999623334670175, 0.9999623310732546, 0.9999623291404934, 0.9999623335012319,
          0.9999623308206421, 0.9999623296882773, 0.9999623336598834, 0.9999623302268363, 0.9999623301262598,
          0.9999623334696552, 0.9999623299298143, 0.9999623304413832, 0.9999623331542348, 0.9999623295638584,
          0.9999623308124537, 0.9999623334736671, 0.9999623291924865, 0.9999623309772581, 0.9999623335320108,
          0.9999623288333993, 0.9999623313138674, 0.9999623332039056, 0.9999623294125777, 0.9999623313994959,
          0.9999623328206058, 0.9999623293177389, 0.9999623319655937, 0.9999623324861572, 0.9999623288884034,
          0.9999623324915543, 0.9999623321023806, 0.9999623291388214, 0.9999623329584276, 0.9999623314440591,
          0.9999623290521888, 0.9999623336399638, 0.9999623308301853, 0.9999623295107342, 0.9999623335923266,
          0.9999623302736673, 0.999962330010502, 0.9999623337740275, 0.9999623294165029, 0.9999623307960532,
          0.999962333351762, 0.9999623293778129, 0.9999623314883573, 0.999962333077127, 0.9999623287628436,
          0.9999623324467473, 0.999962332334901, 0.9999623286177434, 0.9999623328252677, 0.9999623319571114,
          0.9999623294164134, 0.9999623324066901, 0.9999623318780889, 0.9999623294564999, 0.9999623327479139,
          0.9999623313120761, 0.9999623295782798, 0.9999623333496903, 0.9999623304730146, 0.9999623299606307,
          0.9999623337325926, 0.9999623296184987, 0.9999623306627532, 0.9999623336339043, 0.9999623296207084,
          0.9999623309759882, 0.9999623333019942, 0.9999623289852504, 0.9999623317174975, 0.9999623331167324,
          0.9999623286518267, 0.9999623321660899, 0.999962332943719, 0.9999623284866295, 0.9999623326421376,
          0.9999623324071794, 0.9999623287107705, 0.9999623327877708, 0.9999623322553397, 0.9999623289262193,
          0.9999623325963087, 0.9999623317210264, 0.9999623299028387, 0.999962332260643, 0.9999623312839728,
          0.9999623300254856, 0.9999623324989255, 0.9999623313271845, 0.9999623298303871, 0.9999623329241841,
          0.9999623306287889, 0.9999623302193562, 0.9999623332451376, 0.9999623297534197, 0.9999623310461216,
          0.9999623330880149, 0.9999623290299815, 0.9999623319822616, 0.9999623326582651, 0.9999623287012066,
          0.9999623324303266, 0.9999623323077189, 0.9999623287090774, 0.9999623331982642, 0.9999623317041691,
          0.9999623287072448, 0.9999623332885806, 0.9999623314650238, 0.9999623292342917, 0.9999623334583014,
          0.9999623307727722, 0.9999623294945922, 0.9999623338029489, 0.9999623301223821, 0.999962329992285,
          0.9999623339177658, 0.9999623296445043, 0.9999623303932743, 0.9999623339494664, 0.9999623297577146,
          0.9999623307953295, 0.999962333384449, 0.9999623290690569, 0.9999623315732039, 0.9999623330991929,
          0.999962328636596, 0.9999623322514116, 0.999962332681083, 0.9999623292929357, 0.999962332035025,
          0.9999623321121129, 0.9999623294953042, 0.9999623327445558, 0.9999623313451522, 0.9999623293714875,
          0.9999623331953107, 0.9999623312371886, 0.9999623291864566, 0.999962333591556, 0.9999623305713725,
          0.9999623296245284, 0.9999623339137685, 0.9999623298057346, 0.9999623303121858, 0.9999623339151269,
          0.9999623294785419, 0.9999623305753973, 0.9999623337268595, 0.9999623291743014, 0.9999623308699671,
          0.999962333636772, 0.9999623293184042, 0.9999623312314009, 0.999962332990254, 0.9999623294071689,
          0.9999623315258003, 0.9999623328421312, 0.9999623289771539, 0.9999623323815862, 0.9999623323438571,
          0.9999623288071083, 0.9999623328091822, 0.999962331954463, 0.9999623288056081, 0.9999623333871465,
          0.9999623314339412, 0.9999623289321536, 0.9999623335466079, 0.9999623310064687, 0.9999623289636286,
          0.9999623335945063, 0.9999623305500877, 0.9999623296583051, 0.9999623338127784, 0.9999623300606466,
          0.9999623299980287, 0.9999623332788685, 0.999962330316944, 0.9999623306343873, 0.9999623329393961,
          0.9999623297148308, 0.9999623313431955, 0.9999623329118851, 0.9999623292004222, 0.9999623317959926,
          0.9999623329401149, 0.9999623291356122, 0.999962332045186, 0.9999623325188288, 0.9999623288104345,
          0.9999623327887908, 0.9999623318582743, 0.9999623288891644, 0.9999623335006927, 0.9999623309543392,
          0.9999623292639859, 0.9999623336914695, 0.9999623305388333, 0.9999623296150597, 0.9999623339159335,
          0.9999623302785995, 0.999962329928586, 0.9999623331379557, 0.9999623304779667, 0.999962330705053,
          0.9999623320681797, 0.9999623306148749, 0.9999623313876577, 0.9999623322029254, 0.9999623302355349,
          0.9999623306608476, 0.9999623325950334, 0.9999623302950982, 0.9999623307317628, 0.9999623329482376,
          0.9999623296819835, 0.9999623314274659, 0.9999623328017445, 0.9999623291841125, 0.99996233195724,
          0.9999623323742177, 0.999962329008783, 0.9999623328851229, 0.9999623316426794, 0.9999623290554427,
          0.9999623335417424, 0.9999623309983827, 0.9999623293101804, 0.9999623338857395, 0.9999623301910997,
          0.9999623296700876, 0.9999623339359122, 0.9999623298621507, 0.9999623301595217, 0.999962333907376,
          0.9999623291650738, 0.9999623309504424, 0.9999623337785885, 0.9999623288377132, 0.9999623312314938,
          0.9999623333992066, 0.9999623290314612, 0.9999623316992468, 0.9999623330192332, 0.9999623286223351,
          0.9999623323955024, 0.9999623326989391, 0.999962328609079, 0.9999623326865693, 0.9999623323179831,
          0.9999623288388754, 0.9999623327520856, 0.9999623321640515, 0.9999623287773316, 0.9999623330721584,
          0.9999623315513864, 0.999962329183663, 0.9999623330724028, 0.9999623312839306, 0.9999623295021163,
          0.9999623332939979, 0.9999623306080897, 0.9999623298381253, 0.9999623337372693, 0.9999623297342786,
          0.9999623305271248, 0.9999623337879058, 0.99996232898363, 0.9999623310934057, 0.9999623336244476,
          0.9999623287312572, 0.9999623315142246, 0.9999623334179838, 0.9999623287934007, 0.9999623316739666,
          0.9999623333324671, 0.9999623285905855, 0.9999623318546514, 0.9999623332724124]


def solveAndPlot(sstring):
    finalString = sstring

    def ode(y, t):
        x2, x3 = y  # x2 == possition , x3 == velocity
        error = u - x2
        funcError = func.evalFunction(error, finalString)
        dydt = [x3, (-B * x3 - k * x2 + funcError) / M]
        return dydt

    sol = odeint(ode, y0, t)

    # def odeManga(y, t):
    #     x2, x3 = y  # x2 == possition , x3 == velocity
    #     funcError = np.tanh(
    #         np.tanh(np.tanh(np.tanh(u - x2) * 81.6497) * 8) * abs(np.sqrt(np.pi) * np.log(6))) * np.pi * 81.6497
    #     dydt = [x3, (-B * x3 - k * x2 + funcError) / M]
    #     return dydt

    # solManga = odeint(odeManga, y0, t)

    plt.plot(t, sol[:, 0], 'b', label='x(t) - rasa')
    plt.plot(t, mengaX, 'g', label='x(t) - manga')
    plt.title(finalString)
    plt.legend(loc='best')
    plt.xlabel('t')
    plt.ylabel('X')
    plt.grid()
    plt.savefig("01plot.png")
    plt.close()

# solveAndPlot('np.tanh(np.tanh(np.tanh(np.tanh(x0)*81.6497)*8)*abs(np.sqrt(np.pi)* np.log(6)))*np.pi*81.6497')

# menga='np.tanh(np.tanh(np.tanh(np.tanh(x0)*81.6497)*8)*abs(np.sqrt(np.pi)* np.log(6)))*np.pi*81.6497'
